<?xml version="1.0" encoding="UTF-8"?>
<api-group id="script" name="脚本语法" path="/base/script">
    <api id="readme" method="GET" name="readme" path="/readme">
        <script><![CDATA[
            return 'https://www.xclite.com/lite-api/pages/script/'
        ]]></script>
    </api>

    <api id="java" method="GET" name="与Java交互" path="/java">
        <script><![CDATA[
            import 'java.util.Date' as Date;
            import 'java.text.SimpleDateFormat' as SimpleDateFormat;
            var now = new Date();   // 创建对象
            var df = new SimpleDateFormat('yyyy-MM-dd');
            return df.format(now);  // 调用方法
        ]]></script>
    </api>

    <api id="try" method="GET" name="try_catch" path="/try">
        <script><![CDATA[
            try{
                var c = 1 / 0
            }catch(e){  //不用写类型，只写变量即可
                return e.getMessage();
            }finally{
                return 'finally'
            }
            // catch 和finally 都可以不写。
            return 'ok'
        ]]></script>
    </api>


    <api id="if" method="GET" name="if判断" path="/if">
        <script><![CDATA[
           /*
                if 测试
            */
            if(a == 1){
                return 1;
            }else if(a == 2){
                return 2;
            }else{
                return 0;
            }
            /*
            对于条件判断，特意支持了简写的方式
            如 可以直接写
            1、if(a)
            2、else if(a)
            3、while(a)
            4、a ? 1 : 0

            当a的值是以下情况时为false
            null
            空集合
            空Map
            数值 == 0
            空字符串（length == 0）
            false
            其它情况一律视为true
            */

        ]]></script>
    </api>

    <api id="exit" method="GET" name="exit语句" path="/exit">
        <script><![CDATA[
           if(true){
                exit 400,'参数填写有误'
            }
            // 第一个参数为code，第二个为message，第三个为data，至少要填写一个参数。
            exit 200,'success','ok'
        ]]></script>
    </api>


    <api id="convert" method="GET" name="类型转换" path="/convert">
        <script><![CDATA[
           var a = 123;
            var str = "456.0";
            /* 目前转换的办法一共有三种，
                1、使用Java相关函数，如Integer.parseInt
                2、是使用脚本提供的语法::进行转换，支持::int ::double ::string ::byte ::long ::short ::float ::date
                3、使用扩展方法，xxx.asXXX(); 如 a.asInt()
            */
            return {
                '::string': a::string,  // 使用::转换，好处是它是语法级的，不会产生空指针，
                '::int' : str::int(0),  // 转换失败是使用默认值0，
                'ext': a.asString(),   // 使用扩展方法转换
                'toDate' : '2020-01-01'::date('yyyy-MM-dd')
            }
        ]]></script>
    </api>


    <api id="operator" method="GET" name="各类运算符" path="/operator">
        <script><![CDATA[
            var a = 123;    // 定义int型变量，定义变量只能使用var。var可以省略
            var b = 456;
            return {
                '+': a + b,
                '-': a - b,
                '-a' : -a,
                '*': a * b,
                '/': a / b,
                '%': a % b,
                '++': a++,
                '--': a--,
                '>': a > b,
                '>=': a >= b,
                '<': a < b,
                '<=': a <= b,
                '>=': a >= b,
                '==': a == b,
                '===': a === b, // 与JS类似，需要类型一致，值一致才返回true
                '!=': a != b,
                '!==': a !== b, // 与JS类似，需类型不一致或 值不一致 才返回true 与 === 相反
                '&&': a && b,   // 与JS类似，如：true && true --> true ，123 && 456 --> 456 ， null && 123 --> 456
                '||': a || b,    // 与JS类似，如：false && true --> true ，123 || 456 --> 123 ，null || 123 --> 123
                '>>':  8 >> 2,
                '>>>': 8 >>> 2,
                '<<' : 1 << 2,
                '^' : 1 ^ 2,
                '&': 1 & 2,
                '|': 1 | 2
            }
        ]]></script>


    </api>
    <api id="lambda" method="GET" name="定义lambda" path="/lambda">
        <script><![CDATA[
           /*
                测试Lambda
            */
            var lambda1 = e => e + 1; //单参数单行代码，省略括号,省略{}
            var lambda2 = (e) => e +1; //单参数单行代码，不省略括号，省略{} 作用同上
            var lambda4 = e => {e + 1};//单参数无返回值，不能省略{}
            var lambda5 = e => {return e + 1};//单参数有返回值，省略括号,不省略{}
            var lambda6 = (e) => {return e + 1};//单参数有返回值，不省略括号,不省略{}，作用同上
            var lambda7 = (a,b) => a + b; //多参数单行代码，省略{}
            var lambda7 = (a,b) => {return a + b}; //多参数单行代码，有返回值，作用同上
            var lambda8 = (a,b) =>{ //多参数多行代码， 无法省略括号和{}
                a = a + 1;
                return a + b;
            }
            var v1 = lambda1(1);    //返回2
            var v2 = lambda2(v1);    //返回3
            return lambda8(v1,lambda7(v1,v2)); //返回8

        ]]></script>
    </api>


    <api id="optional" method="GET" name="可选连" path="/optional">
        <script><![CDATA[
                   var map = {
                        a : {
                            b : 'ok'
                        },
                        c : 1
                    }
                    // ?. 不会报错，.会报错
                    return map.a.bbbb?.c + '-' + map.a?.b;
        ]]></script>
    </api>

    <api id="spread" method="GET" name="扩展运算符" path="/spread">
        <script><![CDATA[
                var map = {
                    a : 1,
                    b : 2
                }
                var list = [1,2,3,4,5]
                return {
                    ...map, //展开Map
                    c : 3,
                    d : [...list]   // 展开list
                };;
        ]]></script>
    </api>


    <api id="async" method="GET" name="异步执行" path="/async">
        <script><![CDATA[
                var list = [];
                for(index in range(1,10)){
                    // 执行SQL时，为了线程安全，需要把index参数放入lambda参数中。
                    list.add(async (index)=> index);
                }
                return list.map(f => f.get())
        ]]></script>
    </api>
</api-group>